#!/usr/bin/env python3
import os
import sys
import re
from statistics import mean

LOG_DIR = "./logs"


def parse_log_file(file_path):
	"""
	Parse a log file to extract FPS, Draw time, and Update time values.
	"""
	fps_values, draw_times, update_times = [], [], []
	with open(file_path, "r") as file:
		for line in file:
			fps_match = re.search(r"(\d+\.\d+) FPS", line)
			draw_match = re.search(r"(\d+\.\d+) ns \(average Draw time\)", line)
			update_match = re.search(r"(\d+\.\d+) ns \(average Update time\)", line)
			if fps_match:
				fps_values.append(float(fps_match.group(1)))
			if draw_match:
				draw_times.append(float(draw_match.group(1)))
			if update_match:
				update_times.append(float(update_match.group(1)))
	return fps_values, draw_times, update_times


def calculate_averages(file_paths):
	"""
	Calculate average FPS, Draw time, and Update time from multiple log files.
	"""
	fps_values, draw_times, update_times = [], [], []
	for file_path in file_paths:
		fps, draw, update = parse_log_file(file_path)
		fps_values.extend(fps)
		draw_times.extend(draw)
		update_times.extend(update)
	return mean(fps_values), mean(draw_times), mean(update_times)


version1_files = [os.path.join(LOG_DIR, f"results.log.{i}") for i in range(5)]
version2_files = [os.path.join(LOG_DIR, f"results.log.{i}") for i in range(5, 10)]
version1_files[0] = os.path.join(LOG_DIR, "results.log")
version1_avg = calculate_averages(version1_files)
version2_avg = calculate_averages(version2_files)
print("Comparison of Averages:", file=sys.stdout)
print("Metric                  | Version 1 (logs 0-4)   | Version 2 (logs 5-9)", file=sys.stdout)
print("------------------------|------------------------|----------------------", file=sys.stdout)
print(f"FPS (average)           | {version1_avg[0]:.2f}                  | {version2_avg[0]:.2f}", file=sys.stdout)
print(f"Draw time (average ns)  | {version1_avg[1]:.2f}                | {version2_avg[1]:.2f}", file=sys.stdout)
print(f"Update time (average ns)| {version1_avg[2]:.2f}                | {version2_avg[2]:.2f}", file=sys.stdout)
